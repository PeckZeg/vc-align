{"version":3,"sources":["../../../../../examples/Simple.vue","webpack:///./examples/Simple.vue?e129","../../../../../examples/VueTypes.vue","webpack:///./examples/VueTypes.vue?bf43","../../../../../examples/Point.vue","webpack:///./examples/Point.vue?4496","../../../../../src/util.ts","../../../../../src/Align.tsx","../../../../../src/hooks/useBuffer.ts","../../../../../examples sync nonrecursive //.vue$"],"names":["style","margin","width","components","Align","data","state","monitor","random","disabled","randomWidth","align","points","sourceWidth","mounted","this","id","setInterval","Math","beforeUnmount","clearInterval","methods","getTarget","$container","document","getElementById","containerRef","ele","alignRef","node","$align","toggleMonitor","toggleRandom","toggleDisabled","forceAlign","toggleSourceSize","type","checked","ref","target","monitor-window-resize","props","$props","console","log","JSON","stringify","marginBottom","point","onClick","pageX","pageY","monitorResize","element","callback","prevWidth","prevHeight","resizeObserver","ResizeObserver","contains","getBoundingClientRect","height","fixedWidth","floor","fixedHeight","Promise","resolve","then","observe","disconnect","getElement","func","getPoint","defineComponent","name","VueTypes","shape","arrayOf","string","def","undefined","offset","number","targetOffset","overflow","adjustX","oneOfType","bool","adjustY","loose","useCssRight","useCssBottom","useCssTransform","returnUndefined","clientX","clientY","monitorBufferTime","monitorWindowResize","setup","ctx","onAlign","source","result","emit","cacheRef","nodeRef","forceAlignPropsRef","value","watch","toRef","buffer","calledRef","timeoutRef","cancelTrigger","window","clearTimeout","trigger","force","setTimeout","useBuffer","latestDisabled","latestTarget","activeElement","alignElement","alignPoint","container","focus","restoreFocus","cancelForceAlign","resizeMonitor","cancel","sourceResizeMonitor","onMounted","prev","next","watchEffect","winResizeRef","addEventListener","remove","onUnmounted","render","childNode","$slots","default","isVNode","cloneVNode","composeRef","map","webpackContext","req","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","module","exports"],"mappings":"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","file":"static/js/main.4aa0b4af.chunk.js","sourcesContent":["<template>\n  <div :style=\"{ margin: '50px' }\">\n    <p>\n      <button type=\"button\" @click=\"forceAlign\">Force align</button>\n      &nbsp;&nbsp;&nbsp;\n      <button type=\"button\" @click=\"toggleSourceSize\">Resize Source</button>\n      &nbsp;&nbsp;&nbsp;\n      <label>\n        <input\n          type=\"checkbox\"\n          :checked=\"state.monitor\"\n          @change=\"toggleMonitor\"\n        />\n        Monitor window resize\n      </label>\n      <label>\n        <input type=\"checkbox\" :checked=\"state.random\" @change=\"toggleRandom\" />\n        Random Size\n      </label>\n      <label>\n        <input\n          type=\"checkbox\"\n          :checked=\"state.disabled\"\n          @change=\"toggleDisabled\"\n        />\n        Disabled\n      </label>\n    </p>\n\n    <div\n      id=\"container\"\n      :ref=\"containerRef\"\n      :style=\"{\n        border: '1px solid red',\n        width: '80%',\n        height: '500px',\n        ...(state.random ? { width: `${state.randomWidth}%` } : null)\n      }\"\n    >\n      <Align\n        :ref=\"alignRef\"\n        :target=\"getTarget\"\n        :monitor-window-resize=\"state.monitor\"\n        :align=\"state.align\"\n        :disabled=\"state.disabled\"\n      >\n        <div\n          :style=\"{\n            position: 'absolute',\n            width: `${state.sourceWidth}px`,\n            height: '50px',\n            background: 'yellow'\n          }\"\n        >\n          <input :style=\"{ width: '100%' }\" />\n        </div>\n      </Align>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Align from '../src';\n\nexport default {\n  components: { Align },\n\n  data() {\n    return {\n      state: {\n        monitor: true,\n        random: false,\n        disabled: false,\n        randomWidth: 100,\n        align: {\n          points: ['cc', 'cc']\n        },\n        sourceWidth: 50\n      }\n    };\n  },\n\n  mounted() {\n    this.id = setInterval(() => {\n      const { random } = this.state;\n\n      if (random) {\n        this.state.randomWidth = 60 + 40 * Math.random();\n      }\n    }, 1000);\n  },\n\n  beforeUnmount() {\n    clearInterval(this.id);\n  },\n\n  methods: {\n    getTarget() {\n      if (!this.$container) {\n        // parent ref not attached\n        this.$container = document.getElementById('container');\n      }\n\n      return this.$container;\n    },\n\n    containerRef(ele) {\n      this.$container = ele;\n    },\n\n    alignRef(node) {\n      this.$align = node;\n    },\n\n    toggleMonitor() {\n      this.state.monitor = !this.state.monitor;\n    },\n\n    toggleRandom() {\n      this.state.random = !this.state.random;\n    },\n\n    toggleDisabled() {\n      this.state.disabled = !this.state.disabled;\n    },\n\n    forceAlign() {\n      this.$align.forceAlign();\n    },\n\n    toggleSourceSize() {\n      this.state.sourceWidth = this.state.sourceWidth + 10;\n    }\n  }\n};\n</script>\n","import { render } from \"./Simple.vue?vue&type=template&id=6d46bf02&bindings={\\\"state\\\":\\\"data\\\",\\\"getTarget\\\":\\\"options\\\",\\\"containerRef\\\":\\\"options\\\",\\\"alignRef\\\":\\\"options\\\",\\\"toggleMonitor\\\":\\\"options\\\",\\\"toggleRandom\\\":\\\"options\\\",\\\"toggleDisabled\\\":\\\"options\\\",\\\"forceAlign\\\":\\\"options\\\",\\\"toggleSourceSize\\\":\\\"options\\\"}\"\nimport script from \"./Simple.vue?vue&type=script&lang=js\"\nexport * from \"./Simple.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <Align :ref=\"alignRef\">\n    <span />\n  </Align>\n\n  <pre>{{\n    JSON.stringify(\n      state.props,\n      (k, v) => (v === undefined ? '~undefined~' : v),\n      2\n    )\n  }}</pre>\n</template>\n\n<script>\nimport Align from '../src';\n\nexport default {\n  components: { Align },\n\n  data() {\n    return {\n      state: { props: null }\n    };\n  },\n\n  methods: {\n    alignRef(node) {\n      this.state.props = node ? { ...node.$props } : null;\n\n      // eslint-disable-next-line no-console\n      console.log(node);\n    }\n  }\n};\n</script>\n","import { render } from \"./VueTypes.vue?vue&type=template&id=8f292482&bindings={\\\"state\\\":\\\"data\\\",\\\"alignRef\\\":\\\"options\\\"}\"\nimport script from \"./VueTypes.vue?vue&type=script&lang=js\"\nexport * from \"./VueTypes.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <div :style=\"{ marginBottom: '170px' }\">\n    <div\n      :style=\"{\n        margin: '20px',\n        border: '1px solid red',\n        padding: '100px 0',\n        textAlign: 'center'\n      }\"\n      @click=\"onClick\"\n    >\n      Click this region please : )\n    </div>\n\n    <Align :target=\"state.point\" :align=\"{ points: ['cc', 'cc'] }\">\n      <div\n        :style=\"{\n          position: 'absolute',\n          width: '100px',\n          height: '100px',\n          background: 'rgba(0, 255, 0, 0.5)',\n          pointerEvents: 'none'\n        }\"\n      >\n        Align\n      </div>\n    </Align>\n  </div>\n</template>\n\n<script>\nimport Align from '../src';\n\nexport default {\n  components: { Align },\n\n  data() {\n    return {\n      state: {\n        point: null\n      }\n    };\n  },\n\n  methods: {\n    onClick({ pageX, pageY }) {\n      this.state.point = { pageX, pageY };\n    }\n  }\n};\n</script>\n","import { render } from \"./Point.vue?vue&type=template&id=42cf3638&bindings={\\\"state\\\":\\\"data\\\",\\\"onClick\\\":\\\"options\\\"}\"\nimport script from \"./Point.vue?vue&type=script&lang=js\"\nexport * from \"./Point.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import ResizeObserver from 'resize-observer-polyfill';\nimport { TargetPoint } from './interface';\n\nimport contains from '@ayase/vc-util/lib/Dom/contains';\n\nexport function isSamePoint(prev: TargetPoint, next: TargetPoint) {\n  if (prev === next) return true;\n  if (!prev || !next) return false;\n\n  if ('pageX' in next && 'pageY' in next) {\n    return prev.pageX === next.pageX && prev.pageY === next.pageY;\n  }\n\n  if ('clientX' in next && 'clientY' in next) {\n    return prev.clientX === next.clientX && prev.clientY === next.clientY;\n  }\n\n  return false;\n}\n\nexport function restoreFocus(activeElement, container) {\n  // Focus back if is in the container\n  if (\n    activeElement !== document.activeElement &&\n    contains(container, activeElement) &&\n    typeof activeElement.focus === 'function'\n  ) {\n    activeElement.focus();\n  }\n}\n\nexport function monitorResize(element: HTMLElement, callback: Function) {\n  let prevWidth: number = null;\n  let prevHeight: number = null;\n\n  function onResize([{ target }]: ResizeObserverEntry[]) {\n    if (!document.contains(target)) return;\n    const { width, height } = target.getBoundingClientRect();\n    const fixedWidth = Math.floor(width);\n    const fixedHeight = Math.floor(height);\n\n    if (prevWidth !== fixedWidth || prevHeight !== fixedHeight) {\n      // https://webkit.org/blog/9997/resizeobserver-in-webkit/\n      Promise.resolve().then(() => {\n        callback({ width: fixedWidth, height: fixedHeight });\n      });\n    }\n\n    prevWidth = fixedWidth;\n    prevHeight = fixedHeight;\n  }\n\n  const resizeObserver = new ResizeObserver(onResize);\n  if (element) {\n    resizeObserver.observe(element);\n  }\n\n  return () => {\n    resizeObserver.disconnect();\n  };\n}\n","import addEventListener from '@ayase/vc-util/lib/Dom/addEventListener';\nimport { alignElement, alignPoint } from 'dom-align';\nimport { AlignResult, AlignType, TargetPoint, TargetType } from './interface';\nimport VueTypes from 'vue-types';\nimport { Ref } from 'vue';\n\nimport {\n  defineComponent,\n  cloneVNode,\n  isVNode,\n  onMounted,\n  onUnmounted,\n  watchEffect,\n  watch,\n  toRef,\n  ref\n} from 'vue';\nimport { composeRef } from '@ayase/vc-util/lib/ref';\nimport { returnUndefined } from '@ayase/vc-util';\nimport useBuffer from './hooks/useBuffer';\nimport { isSamePoint, monitorResize, restoreFocus } from './util';\n\ntype OnAlign = (source: HTMLElement, result: AlignResult) => void;\n\nexport interface AlignProps {\n  align: AlignType;\n  target: TargetType;\n  monitorBufferTime?: number;\n  monitorWindowResize?: boolean;\n  disabled?: boolean;\n  // children: React.ReactElement;\n}\n\nexport interface AlignRawBindings extends RefAlign {\n  nodeRef: Ref<any>;\n}\n\nexport interface AlignEmits {\n  onAlign?: OnAlign;\n}\n\ninterface MonitorRef {\n  element?: HTMLElement;\n  cancel: () => void;\n}\n\nexport interface RefAlign {\n  forceAlign: () => void;\n}\n\nfunction getElement(func: TargetType) {\n  if (typeof func !== 'function') {\n    return null;\n  }\n\n  return func();\n}\n\nfunction getPoint(point: TargetType) {\n  if (typeof point !== 'object' || !point) {\n    return null;\n  }\n\n  return point;\n}\n\nexport default defineComponent<AlignProps, AlignRawBindings>({\n  name: 'Align',\n\n  props: {\n    align: VueTypes.shape({\n      points: VueTypes.arrayOf(VueTypes.string).def(undefined),\n      offset: VueTypes.arrayOf(VueTypes.number).def(undefined),\n      targetOffset: VueTypes.arrayOf(VueTypes.number).def(undefined),\n      overflow: VueTypes.shape({\n        adjustX: VueTypes.oneOfType([VueTypes.bool, VueTypes.number]),\n        adjustY: VueTypes.oneOfType([VueTypes.bool, VueTypes.number])\n      }).loose,\n\n      useCssRight: VueTypes.bool.def(undefined),\n      useCssBottom: VueTypes.bool.def(undefined),\n      useCssTransform: VueTypes.bool.def(undefined)\n    }).loose.def(returnUndefined),\n\n    target: VueTypes.oneOfType([\n      VueTypes.func,\n      VueTypes.shape({\n        clientX: VueTypes.number,\n        clientY: VueTypes.number,\n        pageX: VueTypes.number,\n        pageY: VueTypes.number\n      }).loose\n    ]).def(returnUndefined),\n\n    monitorBufferTime: VueTypes.number.def(returnUndefined as undefined),\n    monitorWindowResize: VueTypes.bool.def(undefined),\n    disabled: VueTypes.bool.def(undefined)\n  } as undefined,\n\n  setup(props, ctx) {\n    const onAlign = (source, result) => ctx.emit('align', source, result);\n\n    const cacheRef = ref<{ element?: HTMLElement; point?: TargetPoint }>({});\n    const nodeRef = ref();\n\n    // ===================== Align ======================\n    // We save the props here to avoid closure makes props ood\n    const forceAlignPropsRef = ref<{\n      disabled?: boolean;\n      target?: TargetType;\n      onAlign?: OnAlign;\n    }>({});\n\n    forceAlignPropsRef.value.disabled = props.disabled;\n    forceAlignPropsRef.value.target = props.target;\n    forceAlignPropsRef.value.onAlign = onAlign;\n\n    watch(\n      [toRef(props, 'disabled'), toRef(props, 'target')] as const,\n      ([disabled, target]) => {\n        forceAlignPropsRef.value.disabled = disabled;\n        forceAlignPropsRef.value.target = target;\n      }\n    );\n\n    const [forceAlign, cancelForceAlign] = useBuffer(() => {\n      const {\n        disabled: latestDisabled,\n        target: latestTarget\n      } = forceAlignPropsRef.value;\n\n      if (!latestDisabled && latestTarget) {\n        const source = nodeRef.value;\n        const element = getElement(latestTarget);\n        const point = getPoint(latestTarget);\n        let result: AlignResult;\n\n        cacheRef.value.element = element;\n        cacheRef.value.point = point;\n\n        // IE lose focus after element realign\n        // We should record activeElement and restore later\n        const { activeElement } = document;\n\n        if (element) {\n          result = alignElement(source, element, props.align);\n        } else if (point) {\n          result = alignPoint(source, point, props.align);\n        }\n\n        restoreFocus(activeElement, source);\n        onAlign(source, result);\n\n        return true;\n      }\n\n      return false;\n    }, props.monitorBufferTime);\n\n    // ===================== Effect =====================\n    // Listen for target updated\n    const resizeMonitor = ref<MonitorRef>({ cancel: () => {} });\n\n    // Listen for source updated\n    const sourceResizeMonitor = ref<MonitorRef>({ cancel: () => {} });\n\n    onMounted(() => {\n      const element = getElement(props.target);\n      const point = getPoint(props.target);\n\n      if (nodeRef.value !== sourceResizeMonitor.value.element) {\n        sourceResizeMonitor.value.cancel();\n        sourceResizeMonitor.value.element = nodeRef.value;\n        sourceResizeMonitor.value.cancel = monitorResize(\n          nodeRef.value,\n          forceAlign\n        );\n      }\n\n      if (\n        cacheRef.value.element !== element ||\n        !isSamePoint(cacheRef.value.point, point)\n      ) {\n        forceAlign();\n\n        // Add resize observer\n        if (resizeMonitor.value.element !== element) {\n          resizeMonitor.value.cancel();\n          resizeMonitor.value.element = element;\n          resizeMonitor.value.cancel = monitorResize(element, forceAlign);\n        }\n      }\n    });\n\n    // Listen for disabled change\n    watchEffect(() => {\n      if (!props.disabled) {\n        forceAlign();\n      } else {\n        cancelForceAlign();\n      }\n    });\n\n    // Listen for window resize\n    const winResizeRef = ref<{ remove: Function }>(null);\n\n    watchEffect(() => {\n      if (props.monitorWindowResize) {\n        if (!winResizeRef.value) {\n          winResizeRef.value = addEventListener(window, 'resize', forceAlign);\n        }\n      } else if (winResizeRef.value) {\n        winResizeRef.value.remove();\n        winResizeRef.value = null;\n      }\n    });\n\n    // Clear all if unmount\n    onUnmounted(() => {\n      resizeMonitor.value.cancel();\n      sourceResizeMonitor.value.cancel();\n\n      if (winResizeRef.value) {\n        winResizeRef.value.remove();\n      }\n\n      cancelForceAlign();\n    });\n\n    return {\n      forceAlign: () => forceAlign(true),\n      nodeRef\n    };\n  },\n\n  render() {\n    let childNode = this.$slots.default()[0];\n\n    if (isVNode(childNode)) {\n      childNode = cloneVNode(childNode, {\n        ref: composeRef(childNode.ref, 'nodeRef')\n      });\n    }\n\n    return childNode;\n  }\n});\n","import { ref } from 'vue';\n\nexport default (callback: () => boolean, buffer: number) => {\n  const calledRef = ref<boolean>(false);\n  const timeoutRef = ref<number>(null);\n\n  function cancelTrigger() {\n    window.clearTimeout(timeoutRef.value);\n  }\n\n  function trigger(force?: boolean) {\n    if (!calledRef.value || force === true) {\n      if (callback() === false) {\n        // Not delay since callback cancelled self\n        return;\n      }\n\n      calledRef.value = true;\n      cancelTrigger();\n\n      timeoutRef.value = window.setTimeout(() => {\n        calledRef.value = false;\n      }, buffer);\n    } else {\n      cancelTrigger();\n      timeoutRef.value = window.setTimeout(() => {\n        calledRef.value = false;\n        trigger();\n      }, buffer);\n    }\n  }\n\n  return [\n    trigger,\n    () => {\n      calledRef.value = false;\n      cancelTrigger();\n    }\n  ] as const;\n};\n","var map = {\n\t\"./Point.vue\": 105,\n\t\"./Simple.vue\": 103,\n\t\"./VueTypes.vue\": 104\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 60;"],"sourceRoot":""}